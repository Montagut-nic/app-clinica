import{c as u}from"./chunk-ZZF4ZVIA.js";import{V as o,_ as l,g as s}from"./chunk-TOHV62XN.js";var c=class i{sb=l(u).client;logLogin(e,t,n){return s(this,null,function*(){try{let{error:r}=yield this.sb.from("login_logs").insert({user_id:e,email:t,role:n});r&&console.error("[auth] error guardando login_logs",r)}catch(r){console.error("[auth] excepci\xF3n guardando login_logs",r)}})}signInEmailChecked(e,t){return s(this,null,function*(){let{data:n,error:r}=yield this.sb.auth.signInWithPassword({email:e,password:t});if(r?.message.includes("Email not confirmed"))return console.warn("[auth] signInWithPassword error:",r.message),{ok:!1,code:"CONFIRMACION"};if(r)return console.warn("[auth] signInWithPassword error:",r.message),{ok:!1,code:"CREDENCIALES"};let{data:a,error:g}=yield this.sb.from("profiles").select("_rol, _is_approved").eq("_uuid",n.user.id).maybeSingle();return!g&&a?._rol==="especialista"&&a?._is_approved===!1?(yield this.sb.auth.signOut(),{ok:!1,code:"PENDIENTE"}):(yield this.logLogin(n.user.id,n.user.email??null,a?._rol??null),{ok:!0})})}getSession(){return s(this,null,function*(){let{data:e}=yield this.sb.auth.getSession();return e.session??null})}getCurrentUser(){return s(this,null,function*(){let e=yield this.getSession();return e?e.user??null:null})}isAdmin(){return s(this,null,function*(){let e=yield this.getCurrentUser();return e!==null&&e.user_metadata.rol==="admin"})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};
