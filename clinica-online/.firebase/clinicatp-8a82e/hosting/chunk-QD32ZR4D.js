import{a as z,b as G,c as H,d as J,e as K,f as Q,g as X,h as Z,i as $,j as ee,k as ie,l as te}from"./chunk-XUUOKOEX.js";import{a as Y}from"./chunk-J3JJFWGS.js";import{a as j}from"./chunk-JFWMHDSN.js";import{c as U}from"./chunk-ZZF4ZVIA.js";import{c as k,e as D,j as O,k as B}from"./chunk-6ENO3YRF.js";import{Ba as l,Cb as y,Db as C,Eb as E,Pa as q,Ua as A,_ as N,da as g,ea as p,eb as c,fb as i,g as V,gb as n,hb as S,lb as b,mb as v,nb as F,qb as I,vb as h,wb as w,yb as r}from"./chunk-TOHV62XN.js";function ae(a,s){a&1&&(b(0),r(1," Edad es requerida. "),v())}function le(a,s){a&1&&(b(0),r(1," Edad debe ser mayor a 0. "),v())}function se(a,s){a&1&&(b(0),r(1," Correo electr\xF3nico es requerido. "),v())}function de(a,s){a&1&&(b(0),r(1," Ingresa un correo electr\xF3nico v\xE1lido. "),v())}function me(a,s){a&1&&(b(0),r(1," Contrase\xF1a es requerida. "),v())}function ue(a,s){a&1&&(b(0),r(1," La contrase\xF1a debe tener al menos 6 caracteres. "),v())}function ge(a,s){a&1&&S(0,"span",37)}var ne=class a{loader=N(j);router=N(O);sb=N(U).client;toast=N(Y);nombre="";apellido="";edad=null;dni="";email="";password="";loading;fotoAdm;onFileChange(s){let t=s.target.files?.[0]||void 0;this.fotoAdm=t}ngOnInit(){return V(this,null,function*(){document.title="La Cl\xEDnica Online - Registro de Administrador"})}validar(){return this.nombre.trim()?this.apellido.trim()?!this.edad||this.edad<=0?"La edad no es v\xE1lida.":/^\d{6,9}$/.test(this.dni)?/^\S+@\S+\.\S+$/.test(this.email)?(this.password??"").length<6?"La contrase\xF1a debe tener al menos 6 caracteres.":this.fotoAdm?null:"La foto del administrador es obligatoria.":"El correo electr\xF3nico no es v\xE1lido.":"El DNI no es v\xE1lido.":"El apellido es obligatorio.":"El nombre es obligatorio."}submit(){return V(this,null,function*(){let s=this.validar();if(s){this.toast.error(s);return}this.loader.show();try{let _=this.sb.storage.from("avatars"),t=`${this.dni.trim()}-${Date.now()}`,{data:o,error:d}=yield this.sb.rpc("dni_exists",{_doc:this.dni.trim()});if(d){console.warn("[register] dni_exists error:",d),this.toast.error("No se pudo validar el DNI. Intentalo nuevamente.");return}if(o){console.warn("[register] dni_exists:",o),this.toast.error("Ya existe un usuario con ese DNI.");return}let{data:e,error:u}=yield this.sb.rpc("email_exists",{_correo:this.email.trim().toLowerCase()});if(u){console.warn("[register] email_exists error:",u),this.toast.error("No se pudo validar el correo electr\xF3nico. Intentalo nuevamente.");return}if(e){this.toast.error("Ya existe un usuario con ese correo electr\xF3nico.");return}let x=(M,re)=>V(this,null,function*(){if(!M)return null;let oe=(M.name.split(".").pop()||"jpg").toLowerCase(),P=`${t}/${re}-${Date.now()}.${oe}`,{error:W}=yield _.upload(P,M,{upsert:!0});if(W)throw W;return P}),m=null;try{m=yield x(this.fotoAdm,"administrador")}catch(M){console.warn("[register] upload pending error:",M?.message||M)}let{data:f,error:R}=yield this.sb.auth.signUp({email:this.email.trim().toLowerCase(),password:this.password,options:{data:{rol:"admin",nombre:this.nombre.trim(),apellido:this.apellido.trim(),edad:this.edad,dni:this.dni.trim(),obra_social:null,avatar_path1:m,avatar_path2:null,specialties_ids:null,specialty_other:null}}});if(R){this.toast.error(R.message);return}let L=f.user;if(!L){this.toast.error("No se pudo crear el usuario.");return}let{error:T}=yield this.sb.from("profiles").insert({_uuid:L.id,_email:this.email.trim().toLowerCase(),_rol:"admin",_nombre:this.nombre.trim(),_apellido:this.apellido.trim(),_edad:this.edad,_dni:this.dni.trim(),_avatar_path1:m,_is_approved:!0});if(T){console.warn("[register] insert profile error:",T),this.toast.error("No se pudo preparar el perfil de usuario.");return}this.toast.success("Especialista registrado exitosamente. Un correo fue enviado para confirmar la cuenta."),this.router.navigateByUrl("/usuarios")}finally{this.loader.hide()}})}static \u0275fac=function(_){return new(_||a)};static \u0275cmp=q({type:a,selectors:[["app-registro-admin"]],decls:73,vars:26,consts:[["f","ngForm"],["nombreNg","ngModel"],["apellidoNg","ngModel"],["edadNg","ngModel"],["dniNg","ngModel"],["emailNg","ngModel"],["pwdNg","ngModel"],[1,"container","py-4"],["routerLink","/usuarios","aria-label","Volver a la p\xE1gina de inicio",1,"volver-button"],[1,"card","shadow-sm"],[1,"card-header","bg-light","d-flex","align-items-center","gap-2"],[1,"bi","bi-person-plus"],[1,"mb-0"],[1,"card-body"],["novalidate",""],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],["name","nombre","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"invalid-feedback"],["name","apellido","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-4"],["type","number","name","edad","min","1","required","",1,"form-control",3,"ngModelChange","ngModel"],[4,"ngIf"],["name","dni","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"my-4"],["type","email","name","email","required","","email","",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group"],["name","password","required","","minlength","6",1,"form-control",3,"ngModelChange","type","ngModel"],[1,"input-group-text"],[1,"bi","bi-shield-lock"],[1,"mt-4"],[1,"form-label","fw-semibold"],["type","file","accept","image/*",1,"form-control",3,"change"],[1,"d-grid","mt-4"],["type","button",1,"btn","btn-primary","btn-lg",3,"click"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(_,t){if(_&1){let o=F();i(0,"div",7)(1,"a",8),r(2," Volver a Administrar Usuarios "),n(),i(3,"div",9)(4,"div",10),S(5,"i",11),i(6,"h5",12),r(7," Registro Administrador "),n()(),i(8,"div",13)(9,"form",14,0)(11,"div",15)(12,"div",16)(13,"label",17),r(14," Nombre "),n(),i(15,"input",18,1),E("ngModelChange",function(e){return g(o),C(t.nombre,e)||(t.nombre=e),p(e)}),n(),i(17,"div",19),r(18," Nombre es requerido. "),n()(),i(19,"div",16)(20,"label",17),r(21," Apellido "),n(),i(22,"input",20,2),E("ngModelChange",function(e){return g(o),C(t.apellido,e)||(t.apellido=e),p(e)}),n(),i(24,"div",19),r(25," Apellido es requerido. "),n()(),i(26,"div",21)(27,"label",17),r(28," Edad "),n(),i(29,"input",22,3),E("ngModelChange",function(e){return g(o),C(t.edad,e)||(t.edad=e),p(e)}),n(),i(31,"div",19),A(32,ae,2,0,"ng-container",23)(33,le,2,0,"ng-container",23),n()(),i(34,"div",21)(35,"label",17),r(36," DNI "),n(),i(37,"input",24,4),E("ngModelChange",function(e){return g(o),C(t.dni,e)||(t.dni=e),p(e)}),n(),i(39,"div",19),r(40," DNI es requerido. "),n()()(),S(41,"hr",25),i(42,"div",15)(43,"div",16)(44,"label",17),r(45," Correo Electr\xF3nico "),n(),i(46,"input",26,5),E("ngModelChange",function(e){return g(o),C(t.email,e)||(t.email=e),p(e)}),n(),i(48,"div",19),A(49,se,2,0,"ng-container",23)(50,de,2,0,"ng-container",23),n()(),i(51,"div",16)(52,"label",17),r(53," Contrase\xF1a "),n(),i(54,"div",27)(55,"input",28,6),E("ngModelChange",function(e){return g(o),C(t.password,e)||(t.password=e),p(e)}),n(),i(57,"span",29),S(58,"i",30),n(),i(59,"div",19),A(60,me,2,0,"ng-container",23)(61,ue,2,0,"ng-container",23),n()()()(),i(62,"div",31)(63,"label",32),r(64," Im\xE1gen de perfil (obligatorio) "),n(),i(65,"div",15)(66,"div",16)(67,"input",33),I("change",function(e){return g(o),p(t.onFileChange(e))}),n()()()(),S(68,"hr",25),i(69,"div",34)(70,"button",35),I("click",function(){return g(o),p(t.submit())}),A(71,ge,1,0,"span",36),r(72," Crear cuenta "),n()()()()()()}if(_&2){let o=h(10),d=h(16),e=h(23),u=h(30),x=h(38),m=h(47),f=h(56);l(15),w("is-invalid",d.invalid&&(d.touched||o.submitted)),y("ngModel",t.nombre),l(7),w("is-invalid",e.invalid&&(e.touched||o.submitted)),y("ngModel",t.apellido),l(7),w("is-invalid",u.invalid&&(u.touched||o.submitted)),y("ngModel",t.edad),l(3),c("ngIf",u.errors==null?null:u.errors.required),l(),c("ngIf",u.errors==null?null:u.errors.min),l(4),w("is-invalid",x.invalid&&(x.touched||o.submitted)),y("ngModel",t.dni),l(9),w("is-invalid",m.invalid&&(m.touched||o.submitted)),y("ngModel",t.email),l(3),c("ngIf",m.errors==null?null:m.errors.required),l(),c("ngIf",m.errors==null?null:m.errors.email),l(5),w("is-invalid",f.invalid&&(f.touched||o.submitted)),c("type","password"),y("ngModel",t.password),l(5),c("ngIf",f.errors==null?null:f.errors.required),l(),c("ngIf",f.errors==null?null:f.errors.minlength),l(10),c("ngIf",t.loading)}},dependencies:[B,te,Q,z,X,G,H,$,ie,ee,Z,K,J,D,k],styles:[".card-header[_ngcontent-%COMP%]{font-weight:600}.input-group[_ngcontent-%COMP%] > .form-control[_ngcontent-%COMP%]:focus{box-shadow:none}.volver-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.6rem 1.4rem;border-radius:999px;border:none;text-decoration:none;font-weight:600;font-size:.95rem;background:linear-gradient(135deg,var(--blue-green),var(--bright-blue));color:#fff;width:fit-content;margin-bottom:4%;box-shadow:0 8px 20px #00000059,0 0 0 1px #ffffff4d;transition:transform .12s ease,box-shadow .12s ease,filter .12s ease}"]})};export{ne as RegistroAdmin};
